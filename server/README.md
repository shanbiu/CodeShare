# 后端接口文档

## 功能概述

本接口实现了对代码的管理和访问，包含以下功能：

1. 获取单个代码
2. 获取所有代码
3. 提交代码
4. 删除代码
5. 更新代码内容
6. 更新公开状态
7. 更新过期时间
8. 下载代码压缩包

---

## 1. 获取单个代码 (`GET /code/:id`)

- **功能**：根据 ID 获取指定的代码内容。
- **请求参数**：
  - `id`：代码的唯一标识符。
  - `pw`（可选）：如果代码是加密状态，需要传入密码。
- **响应**：
  - **成功**：如果存在且未过期且密码正确，返回代码数据。
  - **失败**：
    - 如果未找到或已过期，返回错误信息。
    - 如果密码错误，返回 403 错误。

---

## 2. 获取所有代码 (`GET /list`)

- **功能**：获取所有代码的列表。
- **请求参数**：无
- **响应**：
  - 返回所有代码数据。

---

## 3. 提交代码 (`POST /submit`)

- **功能**：提交新的代码内容。
- **请求参数**：请求体中包含代码的详细信息（如：`title`, `snippets`, `tags` 等）。
- **响应**：
  - **成功**：返回提交成功消息。
  - **失败**：返回错误信息。

---

## 4. 删除代码 (`DELETE /delete/:id`)

- **功能**：删除指定 ID 的代码。
- **请求参数**：
  - `id`：要删除的代码 ID。
  - `pw`（可选）：如果代码是加密状态，需要传入密码进行验证。
- **响应**：
  - **成功**：如果代码存在且密码正确（如加密状态下），删除并返回成功消息。
  - **失败**：
    - 如果密码错误，返回 403 错误。
    - 如果未找到，返回 404 错误。

---

## 5. 更新代码内容 (`PUT /update/:id`)

- **功能**：更新指定 ID 的代码数据。
- **请求参数**：
  - `id`：要更新的代码 ID。
  - 请求体中包含更新后的数据。
- **响应**：
  - **成功**：返回更新成功消息。
  - **失败**：返回错误信息。

---

## 6. 更新公开状态 (`PATCH /updatePublic/:id`)

- **功能**：切换代码的公开/加密状态。
- **请求参数**：
  - `id`：要更新的代码 ID。
  - `isPublic`：新的公开状态（`true` 表示公开，`false` 表示加密）。
  - `password`（可选）：如果从加密状态切换为公开，需要传入密码进行验证。
- **响应**：
  - **成功**：返回成功消息。
  - **失败**：
    - 如果密码错误，返回 403 错误。

---

## 7. 更新过期时间 (`PATCH /updateExpiration/:id`)

- **功能**：更新代码的过期时间。
- **请求参数**：
  - `id`：要更新的代码 ID。
  - `expire_at`：新的过期时间（日期格式）。
  - `password`（可选）：如果是加密状态，需要提供密码验证。
- **响应**：
  - **成功**：返回过期时间更新成功消息。
  - **失败**：
    - 如果密码错误，返回 403 错误。
    - 如果日期格式不合法，返回 400 错误。

---

## 8. 下载代码压缩包 (`GET /download/:id`)

- **功能**：下载指定 ID 的代码内容，返回压缩包。
- **请求参数**：
  - `id`：要下载的代码 ID。
  - `pw`（可选）：如果是加密状态，提供密码进行验证。
- **响应**：
  - **成功**：返回压缩包文件。
  - **失败**：
    - 如果已过期，返回 400 错误。
    - 如果密码错误，返回 403 错误。
    - 如果未找到，返回 404 错误。

---

## 条件和限制

- **密码保护**：如果代码设置为加密状态，必须提供正确的密码才能进行查看、删除或下载操作。
- **过期检查**：如果代码已经过期，访问时会返回过期信息，禁止访问。
- **权限检查**：在修改公开状态和删除数据时，需验证密码的正确性。
